(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const h=async(n,t)=>{try{const r=await fetch(`http://localhost:3000${n}`,{...t,headers:{"Content-Type":"application/json",...t.headers},credentials:"include"}),i=await r.json();return{response:r,result:i}}catch(r){throw console.error(`API request failed for ${n}:`,r),r}},y=n=>{n.forEach(t=>{t&&(t.textContent="",t.style.display="none")})};document.addEventListener("DOMContentLoaded",async()=>{const n=window.location.pathname;console.log("Current path:",n);const t=n.endsWith("/")?n.slice(0,-1):n;if(!["/index.html","/dashboard.html","/404.html","","/"].includes(t)){console.log("Redirecting to 404.html for invalid path:",t),window.location.href="/404.html";return}if(t===""||t==="/"){console.log("Redirecting root path to /index.html"),window.location.href="/index.html";return}if(t==="/dashboard.html")try{const{response:i,result:e}=await h("/api/check-session",{method:"GET"});if(!i.ok||!e.authenticated){console.log("Session invalid, redirecting to /index.html"),window.location.href="/index.html";return}const o=document.getElementById("welcomeMessage");o&&(o.textContent=`Welcome, ${e.username}!`);const c=["/pictures/pepe.gif","/pictures/theresa.gif","/pictures/viro.gif"],w=Math.floor(Math.random()*c.length),m=document.getElementById("gifImage");m&&(m.src=c[w]);const f=document.getElementById("signoutBtn"),s=document.getElementById("errorMessage"),a=document.getElementById("successMessage"),u=document.getElementById("createPostForm");f&&f.addEventListener("click",async()=>{y([s,a]);try{const{response:d,result:l}=await h("/api/signout",{method:"POST"});d.ok?window.location.href=l.redirect||"/index.html":(s.textContent=l.message||"Signout failed",s.style.display="block")}catch{s.textContent="An error occurred during signout.",s.style.display="block"}}),u&&u.addEventListener("submit",async d=>{var g;d.preventDefault(),y([s,a]);const l=(g=document.getElementById("postText"))==null?void 0:g.value;if(!l||l.length>100){s.textContent="Post text is required and must be 100 characters or less",s.style.display="block";return}try{const{response:p,result:x}=await h("/api/create-post",{method:"POST",body:JSON.stringify({post_text:l})});p.ok?(a.textContent="Post created successfully!",a.style.display="block",u.reset()):(s.textContent=x.message||"Failed to create post",s.style.display="block")}catch{s.textContent="An error occurred while creating the post.",s.style.display="block"}})}catch{console.log("Session check failed, redirecting to /index.html"),window.location.href="/index.html"}});
